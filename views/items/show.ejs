<% include ../partials/header %>

<div class="container">
	<div class="row">

		<!-- Item info container -->
		<div class="col-md-8">
			<div class="thumbnail">
				<img class="img-responsive" src="<%= item.image %>">
				<div class="caption-full">
					<h4 class="pull-right"><strong>$<%= item.price %></strong></h4>
					<h4><a><%= item.name %></a></h4>
					<p><%= item.description %></p>
					
          <div class="text-right">
            <span class="pull-left">
						<em>Posted By <strong><%= item.author.username %> </strong><%= moment(item.createdAt).fromNow() %></em>
					  </span>
					  <a class="btn btn-default" href="/items/<%= item._id %>/comments/new">Comment</a>
				  </div>
					<!-- Check if user owns the item -->
					<% if(currentUser && item.author.id.equals(currentUser._id)) { %>
						<!-- Edit and Delete buttons -->
						<a class="btn btn-xs btn-warning" href="/items/<%= item._id %>/edit">Edit</a>
						<form class="delete-form" action="/items/<%= item._id %>?_method=DELETE" method="POST">
							<button class="btn btn-xs btn-danger">Delete</button>
						</form>
					<% } %>
				</div>
			</div>

			<!-- Comments container -->
			<div class="well">
				<!-- New comment button -->
				<h4>
          <strong>Comments</strong>
        </h4>
				<hr/>
				<!-- Comments -->
				<% item.comments.forEach((comment) => { %>
					<div class="row">
						<div class="col-md-12">
							<strong><%= comment.author.username %></strong>
							<span class="pull-right"> <em><%= moment(comment.createdAt).fromNow() %></em></span>
							<p><%= comment.text %></p>
							<!-- Check if user owns the comment -->
							<% if(currentUser && comment.author.id.equals(currentUser._id)) { %>
								<!-- Edit and Delete buttons -->
								<a class="btn btn-xs btn-warning"
									 href="/items/<%=item._id %>/comments/<%= comment._id %>/edit">Edit</a>
								<form class="delete-form" action="/items/<%=item._id %>/comments/<%= comment._id %>?_method=DELETE" method="POST">
									<input type="submit" class="btn btn-xs btn-danger" value="Delete">
								</form>
							<% } %>
						</div>
					</div>
				<% }); %>
			</div>
		</div>
	</div>
</div>

<% include ../partials/footer %>
